### DNS查询

![域名browser]()

    http://www.apple.com

今天你准备买iPhoneX，你打开浏览器输入www.apple.com。回车，浏览器跳到苹果的官网，然后把iPhoneX的沙龙照显示出来。浏览器是如何找到这些内容的呢？

我小的时候网络还非常不发达，家家户户都准备着一本比字典还要厚的黄页来专门记载每户的电话号码。如果我今天要打给魏同学问作业，首先要翻到字母表w，然后找到他的名字，然后找到对应的电话号码。难以置信吧，我现在回想起来也觉得。其实互联网一开始也是这么做的，互联网刚诞生不久的时候，只有一些高校和科学家在用，全部的联网机器加起来才300多台。每台机器都有一个类似黄页的文件（hosts文件）。专门记载这个域名对应哪个ip地址，这个文件的内容就像：

www.apple.com 119.145.144.223
www.ieee.org  23.38.177.118

当有了ip地址之后，就能访问那台计算机获取到我们想要的信息了。至于怎么获取我们会在ip地址这一节里面介绍。这个阶段域名其实就是ip的别名，

问题随着时间发展出现了，小时候的黄页每年买一本，要是在一年中你更换了电话号码，其他人也就找不到你了。互联网也是，每个小时都有新的域名被注册，新的主机加入互联网，如果还只是继续更新一个文件会有几个问题。1. 主机数量太多了，现在已经超过10亿台设备接入互联网，每次查询的话都要从这里面查会比较慢。2. 大部分的网站用户根本不会上，就像大部分在黄页上的人我都不会联系。每上线一个小网站就更新全球的电脑这样显然小题大做了。那么有什么方法可以解决这个问题呢？

![更新hosts]()


现代的计算机域名查询ip会经过这几个步骤：

1. 先查询浏览器有没有保留缓存
    如果你之前访问过这个网站，那么浏览器会保存对应的ip地址，这样就能减少查询ip的时间。

2. 查询本地的hosts文件
    （没错，hosts文件还没有退出时代）如果hosts文件有对应的内容，例如上面的

        www.apple.com 119.145.144.223
    那么计算机就会直接使用这个ip

3. DNS服务器查询
    全球一共有13组共[632台根域名服务器](https://en.wikipedia.org/wiki/Root_name_server)，分布在世界各地，每台下面又有N台子域名服务器。子域名服务器专门保存和更新域名和ip的对应关系。
    当计算机在前两个方法都没有找到对应的ip，就会进行dns查询，其实就是问一下最近的子域名服务器，从它们中获取到ip地址，而子域名服务器自己会定时从根域名服务器中获取最新的内容。这样，每次我就不用保存和更新全世界所有网站对应的ip，上哪个网就查询哪个。

Q&A
    那么是不是破坏这13组根域名服务器就能破坏互联网的查询功能呢？例如别人如果输入苹果的域名却跳到一个其他的网站呢。
    是的。很遗憾它分布在全世界各个地区，很难同时攻击它们 :D

    浏览器直接输入ip地址，是不是就能访问到apple.com呢？
    很遗憾地说，在现在的互联网，大部分情况下是不可以的。如果想知道详细的请看域名解析

